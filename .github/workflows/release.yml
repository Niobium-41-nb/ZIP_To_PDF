name: Create Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build-and-release:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: Build executable
      run: |
        pyinstaller --onefile --name "ZipToPDF" --add-data "templates;templates" --add-data "static;static" --add-data "utils;utils" --add-data "config.py;." --hidden-import=flask --hidden-import=werkzeug --hidden-import=PIL --hidden-import=PIL.Image --hidden-import=img2pdf --hidden-import=python_magic --hidden-import=rarfile --hidden-import=py7zr --hidden-import=jmcomic --hidden-import=utils.file_utils --hidden-import=utils.compression --hidden-import=utils.image_processor --hidden-import=utils.pdf_generator run.py
        
    - name: Create release package
      run: |
        mkdir release
        copy dist\ZipToPDF.exe release\
        copy README.md release\
        copy LICENSE release\
        copy QuickStart.bat release\
        copy UserManual.md release\
        
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: release/*
        body: |
          # å‹ç¼©åŒ…è½¬PDFå·¥å…· ${{ github.ref_name }}
          
          ## ğŸ‰ æ–°ç‰ˆæœ¬å‘å¸ƒ
          
          ### åŠŸèƒ½ç‰¹æ€§
          - âœ… å‹ç¼©åŒ…è½¬PDFåŠŸèƒ½
          - âœ… JMæ¼«ç”»ä¸‹è½½å’Œè½¬æ¢
          - âœ… Webç•Œé¢å’Œå‘½ä»¤è¡ŒåŒæ¨¡å¼
          - âœ… å•æ–‡ä»¶å¯æ‰§è¡Œç¨‹åº
          
          ### ä½¿ç”¨è¯´æ˜
          1. ä¸‹è½½ `å‹ç¼©åŒ…è½¬PDFå·¥å…·.exe`
          2. åŒå‡»è¿è¡Œæˆ–ä½¿ç”¨å‘½ä»¤è¡Œ
          3. è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ `å¯æ‰§è¡Œæ–‡ä»¶ä½¿ç”¨è¯´æ˜.md`
          
          ### ç³»ç»Ÿè¦æ±‚
          - Windows 7/8/10/11
          - 4GB RAM (æ¨è)
          - 2GB å¯ç”¨ç£ç›˜ç©ºé—´
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}