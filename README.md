# Flask压缩包转PDF工具

一个基于Python Flask的Web应用，能够处理嵌套压缩包，提取其中的图片文件，并按文件夹分组生成A4竖排的PDF文件。

## 功能特性

- ✅ **支持多种压缩格式**: ZIP, TAR, RAR, 7Z (包括.tar.gz, .tar.bz2)
- ✅ **嵌套压缩包处理**: 自动递归解压多层嵌套的压缩包
- ✅ **多种图片格式支持**: JPG, PNG, WEBP, GIF, BMP
- ✅ **按文件夹分组**: 保持原始目录结构，按文件夹生成多个PDF
- ✅ **保持图片顺序**: 按文件名自然排序，保持图片原始顺序
- ✅ **A4竖排PDF**: 生成标准A4尺寸的PDF文件
- ✅ **实时进度显示**: 上传、解压、处理、生成全过程进度显示
- ✅ **大文件支持**: 支持最大1GB的压缩包
- ✅ **用户友好界面**: 现代化的Web界面，支持拖拽上传
- ✅ **灵活的下载选项**: 支持完整包下载和单个PDF文件下载

## 项目结构

```
zip_to_pdf_app/
├── app.py                    # Flask主应用
├── requirements.txt          # Python依赖包
├── config.py                # 配置文件
├── README.md                # 项目说明文档
├── utils/                   # 工具模块
│   ├── __init__.py
│   ├── file_utils.py        # 文件处理工具
│   ├── compression.py       # 压缩包处理
│   ├── image_processor.py   # 图片处理
│   └── pdf_generator.py     # PDF生成
├── static/
│   ├── css/
│   │   └── style.css        # 样式文件
│   └── js/
│       └── main.js          # 前端JavaScript
├── templates/
│   └── index.html           # 主页面模板
├── uploads/                 # 上传文件临时存储
├── temp/                    # 解压临时目录
└── outputs/                 # 生成的PDF文件
```

## 安装和运行

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行应用

```bash
python app.py
```

### 3. 访问应用

打开浏览器访问: http://localhost:5000

## 使用说明

1. **上传压缩包**: 点击选择文件或拖拽压缩包到上传区域
2. **等待处理**: 系统会自动解压、处理图片并生成PDF
3. **下载结果**: 处理完成后选择下载方式：
   - **完整包下载**: 下载包含所有PDF的ZIP文件
   - **单独下载**: 在PDF文件列表中单独下载需要的PDF

## 下载结果

处理完成后，系统提供多种下载方式：

### 1. 完整下载
- 下载包含所有PDF文件的ZIP压缩包
- 适合批量下载所有转换结果

### 2. 单独下载
- 查看生成的PDF文件列表
- 单独下载每个PDF文件
- 适合只需要部分文件的情况

### 下载功能特点：
- **ZIP包下载**: 一键下载所有PDF文件
- **PDF列表**: 显示每个PDF文件的详细信息（文件名、大小）
- **单独下载**: 点击即可下载单个PDF文件
- **响应式设计**: 在手机和电脑上都能良好显示

## 技术栈

- **后端**: Python Flask
- **文件处理**: zipfile, tarfile, rarfile, py7zr
- **图片处理**: Pillow (PIL)
- **PDF生成**: img2pdf
- **文件类型检测**: mimetypes (Python内置)
- **前端**: HTML5, CSS3, JavaScript (原生)

## 配置说明

在 `config.py` 中可以修改以下配置：

- **文件大小限制**: 默认1GB
- **支持的压缩格式**: ZIP, TAR, RAR, 7Z等
- **支持的图片格式**: JPG, PNG, WEBP等
- **PDF页面设置**: A4竖排
- **临时文件清理**: 24小时自动清理

## API接口

### POST /upload
文件上传接口
- 参数: file (压缩包文件)
- 返回: task_id (任务ID)

### GET /status/<task_id>
获取处理状态
- 返回: 处理进度、状态信息

### GET /download/<task_id>
下载处理结果（ZIP包）
- 返回: PDF文件包ZIP

### GET /download/list/<task_id>
获取PDF文件列表
- 返回: PDF文件信息列表

### GET /download/pdf/<task_id>/<pdf_index>
下载单个PDF文件
- 返回: 指定的PDF文件

### POST /cleanup
清理临时文件

## 处理流程

1. **文件上传**: 接收并验证压缩包文件
2. **递归解压**: 自动解压所有嵌套压缩包
3. **图片收集**: 按文件夹分组收集图片文件
4. **图片处理**: 格式转换和尺寸优化
5. **PDF生成**: 按文件夹生成多个PDF文件
6. **结果打包**: 将所有PDF打包成ZIP文件
7. **文件下载**: 提供多种下载选项

## 注意事项

- 确保有足够的磁盘空间处理大文件
- 临时文件会自动清理，避免磁盘空间占用
- 支持中文字符的文件名和路径
- 建议在本地网络环境中使用

## 故障排除

### 常见问题

1. **文件上传失败**
   - 检查文件大小是否超过1GB限制
   - 检查文件格式是否支持

2. **解压失败**
   - 检查压缩包是否损坏
   - 检查是否受密码保护

3. **PDF生成失败**
   - 检查图片文件是否损坏
   - 检查磁盘空间是否充足

### 日志查看

应用运行时的错误信息会在控制台输出，可以据此进行故障诊断。

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。